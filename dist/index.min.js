!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("log4js"),require("fs"),require("path"),require("chalk")):"function"==typeof define&&define.amd?define(["exports","log4js","fs","path","chalk"],r):r((e=e||self).Index={},e.log4js,e.fs,e.path,e.chalk)}(this,(function(e,r,n,t,o){"use strict";function s(e,r,n,t,o,s,a){try{var i=e[s](a),u=i.value}catch(e){return void n(e)}i.done?r(u):Promise.resolve(u).then(t,o)}n=n&&n.hasOwnProperty("default")?n.default:n,t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var a=t.resolve,i=(t.join,a(__dirname),a(__dirname,"../logs")),u={appenders:{errorLogger:{type:"dateFile",filename:i+"/error/error",alwaysIncludePattern:!0,pattern:"-yyyy-MM-dd-hh.log",path:"/error"},resLogger:{type:"dateFile",filename:i+"/response/response",alwaysIncludePattern:!0,pattern:"-yyyy-MM-dd-hh.log",path:"/response"}},categories:{default:{appenders:["resLogger","errorLogger"],level:"info"},errorLogger:{appenders:["errorLogger"],level:"error"},resLogger:{appenders:["resLogger"],level:"info"}},baseLogPath:i};r.configure(u);var g={},l=function(e){n.existsSync(e)||(n.mkdirSync(e),console.log("createPath:"+e))};u.baseLogPath&&(l(u.baseLogPath),Object.values(u.appenders).forEach((function(e){e.path&&l(u.baseLogPath+e.path)})));var p=r.getLogger("errorLogger"),c=r.getLogger("resLogger");g.logError=function(e,r,n){e&&r&&p.error(d(e,r,n))},g.logResponse=function(e,r){e&&c.info(f(e,r))};var f=function(e,r){var n="";return n+="\n*************** response log start ***************\n",n+=h(e.request,r),n+="response status: "+e.status+"\n",n+="response body: \n"+JSON.stringify(e.body)+"\n",n+="*************** response log end ***************\n"},d=function(e,r,n){var t="";return t+="\n*************** error log start ***************\n",t+=h(e.request,n),t+="err name:"+r.name+"\n",t+="err message:"+r.message+"\n",t+="err stack:"+r.stack+"\n",t+="*************** error log end ***************\n"},h=function(e,r){var n="",t=e.method;return n+="request method: "+t+"\n",n+="request originalUrl: "+e.originalUrl+"\n",n+="request client ip: "+e.ip+"\n",n+="GET"===t?"request query: "+JSON.stringify(e.query)+"\n":"request body: \n"+JSON.stringify(e.body)+"\n",n+="response time:"+r+"\n"},y=function(){var e,r=(e=regeneratorRuntime.mark((function e(r,n){var t,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,e.prev=1,e.next=4,n();case 4:s=new Date-t,console.log(o.blue("%s")+" "+r.request.method+" "+r.request.url,Date.now()),g.logResponse(r,s),e.next=15;break;case 9:e.prev=9,e.t0=e.catch(1),r.response.body={message:e.t0.message},s=new Date-t,g.logError(r,e.t0,s),r.app.emit("error",e.t0,r);case 15:case"end":return e.stop()}}),e,null,[[1,9]])})),function(){var r=this,n=arguments;return new Promise((function(t,o){var a=e.apply(r,n);function i(e){s(a,t,o,i,u,"next",e)}function u(e){s(a,t,o,i,u,"throw",e)}i(void 0)}))});return function(e,n){return r.apply(this,arguments)}}();e.koaLogger=y,Object.defineProperty(e,"__esModule",{value:!0})}));
